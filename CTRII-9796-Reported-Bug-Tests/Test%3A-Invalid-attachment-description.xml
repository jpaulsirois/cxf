<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="ff70cd2a-5b25-4351-945c-aea7e9109923" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="Test: Invalid attachment description" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config"><con:description id="57899d45-63ad-4f69-af24-65f2fc1d44ea">Verify  uploadAttachment  reponse :  ensure you get no stack trace and a meaningful error message.
When input : invalid attachment  desdescripton  ( NULL) 
  </con:description><con:settings><con:setting id="ff70cd2a-5b25-4351-945c-aea7e9109923fileName">Test%3A-Invalid-attachment-description</con:setting></con:settings><con:savedRecentRuns>1</con:savedRecentRuns><con:testStep type="groovy" name="ProjectData" id="6abeb066-c814-421f-8b5f-7cee2ec7aff0"><con:settings/><con:config><script>def tSuite = testRunner.getTestCase().getTestSuite()

    tSuite.setPropertyValue("donorDeathTypeId", "1")
    tSuite.setPropertyValue("donorFacility-1-Id", "17")
    tSuite.setPropertyValue("donorFacility-2-Id", "3")
    tSuite.setPropertyValue("donorTypeId", "4")
    tSuite.setPropertyValue("recipientHlaLabId", "93")
    tSuite.setPropertyValue("recipientOdoId", "23")
    tSuite.setPropertyValue("recipientPrefix", "QT-")
    tSuite.setPropertyValue("recipientTxCenterId", "92")
    tSuite.setPropertyValue("recipientProvId", "11")
    tSuite.setPropertyValue("phinProvince", "11")
    tSuite.setPropertyValue("city", "Montreal")
    //tSuite.setPropertyValue("recipientId", null)
    //tSuite.setPropertyValue("donorId", null)
</script></con:config></con:testStep><con:testStep type="groovy" name="TestSuiteData" id="b7a4bb30-ec4d-481d-bee4-d801b8e6e054"><con:settings/><con:config><script>def tSuite = testRunner.getTestCase().getTestSuite()

    tSuite.setPropertyValue("donorDeathTypeId", "1")
    tSuite.setPropertyValue("donorFacility-1-Id", "17")
    tSuite.setPropertyValue("donorFacility-2-Id", "3")
    tSuite.setPropertyValue("donorTypeId", "4")
    tSuite.setPropertyValue("recipientHlaLabId", "93")
    tSuite.setPropertyValue("recipientOdoId", "23")
    tSuite.setPropertyValue("recipientPrefix", "QT-")
    tSuite.setPropertyValue("recipientTxCenterId", "92")
    tSuite.setPropertyValue("recipientProvId", "11")
    tSuite.setPropertyValue("phinProvince", "11")
    tSuite.setPropertyValue("city", "Montreal")
    //tSuite.setPropertyValue("recipientId", null)
    //tSuite.setPropertyValue("donorId", null)
</script></con:config></con:testStep><con:testStep type="groovy" name="Setup recipient fields" id="8535fb96-eb76-4318-9648-b73ebfc2d8a6"><con:settings/><con:config><script>import cbs.DateUtils;
import cbs.LookupUtils;
import cbs.CtrUtils;

    def dateUtils = new DateUtils()
    def lookupUtils = new LookupUtils()
    def ctrUtils= new CtrUtils()

    def tCase = testRunner.getTestCase()
    Date dateNow = new Date()

    tCase.setPropertyValue("recRndId", ctrUtils.getRndId().toString())

    Date dateOfBirth = ctrUtils.getRndDOB(20,50)
    tCase.setPropertyValue("dateOfBirth", dateUtils.formatDate( dateOfBirth ))

    //genderId = lookupUtils.getRandomLookupId("LT_GENDER")
    tCase.setPropertyValue("genderId", lookupUtils.getRandomLookupId("LT_GENDER") )

    height = ctrUtils.getRndHeight(dateUtils.formatDate( dateOfBirth ))
    tCase.setPropertyValue("height", height.toString() )

    weight = ctrUtils.getRndWeight(dateUtils.formatDate( dateOfBirth ))
    tCase.setPropertyValue("weight", weight.toString() )

    //bloodGroupId = lookupUtils.getRandomLookupId("LT_ABO")
    tCase.setPropertyValue("bloodGroupId", lookupUtils.getRandomLookupId("LT_ABO") )

    rhId = lookupUtils.getRandomLookupId("LT_RH")
    tCase.setPropertyValue("rhId", rhId )

    Date mostRecentDialysisDate = ctrUtils.getRandomDateFromInterval(dateOfBirth, dateNow);
    tCase.setPropertyValue("mostRecentDialysisDate", dateUtils.formatDate(mostRecentDialysisDate))
    log.info("mostRecentDialysisDate: "+mostRecentDialysisDate)

    Date listDateTime = ctrUtils.getRandomDateFromInterval(mostRecentDialysisDate, dateNow);
    tCase.setPropertyValue("listDateTime", dateUtils.formatDate(listDateTime))
    log.info("listDateTime: "+listDateTime)

    Date medicalStatusChangeDate = ctrUtils.getRandomDateFromInterval(listDateTime, dateNow);
    tCase.setPropertyValue("listDateTime", dateUtils.formatDate(medicalStatusChangeDate))
    log.info("medicalStatusChangeDate: "+medicalStatusChangeDate)

    log.info("The end")
</script></con:config></con:testStep><con:testStep type="request" id="ab8521ff-cb1e-4112-a20b-f843e3f16bc2" name="Recipient-Fields minimal-Ror kidney - heart"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>ExternalCtr3WSPortBinding</con:interface><con:operation>addRecipientByNationalRecipientId</con:operation><con:request name="Recipient-Fields minimal-Ror kidney - heart" id="26b4eb36-2fe6-4d92-998b-66887b7da136"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>https://ctr2test3.transplantregistry.ca:443/otd-ws/ctr3</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ctr="http://ctr3ws.cbs.com/">
   <soapenv:Header>
      <wsse:Security soapenv:mustUnderstand="0" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">
         <wsse:UsernameToken wsu:Id="UsernameToken-3" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">
            <wsse:Username>WS_QC</wsse:Username>
            <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">Anypw123!</wsse:Password>
         </wsse:UsernameToken>
      </wsse:Security>
   </soapenv:Header>
   <soapenv:Body>
      <ctr:addRecipientByNationalRecipientId>
         <arg0>
            <firstName>Fn-${#TestCase#recRndId}</firstName>
            <lastName>Ln-${#TestCase#recRndId}</lastName>
            <city>Montreal</city>
            <province>
               <id>11</id>
               <!--<bizRef>QC</bizRef>-->
            </province>
            <dateOfBirth>${#TestCase#dateOfBirth}</dateOfBirth>
            <gender>
               <id>${#TestCase#genderId}</id>
            </gender>
            <height>${#TestCase#height}</height>
            <weight>${#TestCase#weight}</weight>
            <localRecipientId>localId-${#TestCase#recRndId}</localRecipientId>
            <phin>QT-${#TestCase#recRndId}</phin>
            <transplantType>
               <id>1</id>
            </transplantType>
            <bloodGroup>
               <id>${#TestCase#bloodGroupId}</id>
            </bloodGroup>
            <rh>
               <id>${#TestCase#rhId}</id>
            </rh>
            <organRequests>
               <!--heart-->
               <id>0</id>
               <organMedicalStatus>
                  <id>2</id>
               </organMedicalStatus>
               <organRequired>
                  <id>1</id>
               </organRequired>
               <listDateTime>${#TestCase#listDateTime}</listDateTime>
               <status>
                  <id>2</id>
               </status>
            </organRequests>
            <opo>
               <!--<id>${#Project#recipientOdoId}</id>-->
               <id>23</id>
               <!--<facilityName>Transplant-Qu√©bec</facilityName>-->
            </opo>
            <!--Optional:-->
            <transplantCentre>
               <id>${#TestSuite#recipientTxCenterId}</id>
            </transplantCentre>
            <!--<referralCentres>-->
            <!--<id>?</id>-->
            <!--</referralCentres>-->
            <hlaLab>
               <id>${#TestSuite#recipientHlaLabId}</id>
            </hlaLab>
            <phinProvince>
               <!--<id>${#Project#phinProvince}</id>-->
               <id>11</id>
            </phinProvince>
         </arg0>
      </ctr:addRecipientByNationalRecipientId>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Fault Assertion" id="ddd7baa0-eee3-4552-8c61-5391202d2861" name="Not SOAP Fault"/><con:assertion type="Schema Compliance" id="fa9aef0c-f842-48cf-b0f2-4ac7e15fcff9" name="Schema Compliance"><con:configuration/></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:wsaConfig action="http://ctr3ws.cbs.com/ExternalCtr3WS/addRecipientByNationalRecipientIdRequest" mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/><con:environmentSpec><con:entry environmentId="c94d917d-022b-4762-a9eb-762d7b0415eb"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:request></con:config></con:testStep><con:testStep type="groovy" name="Save recipient" id="2bedd30d-6991-4bf3-90c2-7ae5c70b732f"><con:settings/><con:config><script>def tCase = testRunner.getTestCase()

def recipientId = context.expand( '${Recipient-Fields minimal-Ror kidney - heart#Response#declare namespace ns2=\'http://ctr3ws.cbs.com/\'; //ns2:addRecipientByNationalRecipientIdResponse[1]/return[1]/nationalRecipientId[1]}' )
tCase.setPropertyValue("recipientId", recipientId )

def rorIdHeart = context.expand( '${Recipient-Fields minimal-Ror kidney - heart#Response#declare namespace ns2=\'http://ctr3ws.cbs.com/\'; //ns2:addRecipientByNationalRecipientIdResponse[1]/return[1]/organRequests[1]/id[1]}' )
tCase.setPropertyValue("rorIdHeart", rorIdHeart )
</script></con:config></con:testStep><con:testStep type="request" id="9ec15a83-8f22-433c-9b51-145de601f759" name="uploadAttachment- no  attachment descripton"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>ExternalCtr3WSPortBinding</con:interface><con:operation>uploadAttachment</con:operation><con:request name="uploadAttachment- no  attachment descripton" id="a0d0a6bc-8db1-4acd-b81b-ba63639327f0"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>https://ctr2test3.transplantregistry.ca:443/otd-ws/ctr3</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ctr="http://ctr3ws.cbs.com/">
   <soapenv:Header>
      <wsse:Security soapenv:mustUnderstand="0" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">
         <wsse:UsernameToken wsu:Id="UsernameToken-3" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">
            <wsse:Username>WS_QC</wsse:Username>
            <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">Anypw123!</wsse:Password>
         </wsse:UsernameToken>
      </wsse:Security>
   </soapenv:Header>
   <soapenv:Body>
      <ctr:uploadAttachment>
         <arg0>
            <attachmentID>0</attachmentID>
            
            <nationalID>${#TestCase#recipientId}</nationalID><attachmentSection>
               <bizRef>PATIENT_HEALTH</bizRef>
            </attachmentSection>
            
            <sideBysideFlag>true</sideBysideFlag><ownerID>${#TestCase#rorIdHeart}</ownerID>
         </arg0>
         <arg1>
            <attachmentData>BaseHealthService</attachmentData>
            <filename>${#Project#attachmentsFolder}/all-tests.html</filename>
         </arg1>
      </ctr:uploadAttachment>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="Not SOAP Fault Assertion" id="912f291f-a9af-4fb4-9f56-bec6aa40a3a2" name="SOAP Fault"/><con:assertion type="Schema Compliance" id="0eb0dc3e-eee0-4231-ad2b-262061326422" name="Schema Compliance"><con:configuration/></con:assertion><con:assertion type="Simple Contains" name="Contains: ErrorID: attachment.error.empty.description" id="9006b14e-b722-4891-954c-79473ca5e192"><con:configuration><token>ErrorID: attachment.error.empty.description;</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:assertion type="Simple Contains" name="Contains: Description is mandatory" id="b17f4b06-2d88-4ec4-92e0-153c01faa788"><con:configuration><token>Msg: Description is mandatory.;</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:wsaConfig action="http://ctr3ws.cbs.com/ExternalCtr3WS/uploadAttachmentRequest" mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/><con:environmentSpec><con:entry environmentId="c94d917d-022b-4762-a9eb-762d7b0415eb"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:request></con:config></con:testStep><con:properties><con:property><con:name>recRndId</con:name><con:value>16940182975</con:value></con:property><con:property><con:name>dateOfBirth</con:name><con:value>1985-09-03</con:value></con:property><con:property><con:name>genderId</con:name><con:value>1</con:value></con:property><con:property><con:name>height</con:name><con:value>144</con:value></con:property><con:property><con:name>weight</con:name><con:value>125</con:value></con:property><con:property><con:name>bloodGroupId</con:name><con:value>2</con:value></con:property><con:property><con:name>rhId</con:name><con:value>1</con:value></con:property><con:property><con:name>mostRecentDialysisDate</con:name><con:value>2015-07-22</con:value></con:property><con:property><con:name>listDateTime</con:name><con:value>2017-12-10</con:value></con:property><con:property><con:name>recipientId</con:name><con:value>CTR051226</con:value></con:property><con:property><con:name>rorIdHeart</con:name><con:value>159002</con:value></con:property></con:properties><con:reportParameters/><con:environmentSpec><con:entry environmentId="c94d917d-022b-4762-a9eb-762d7b0415eb"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:testCase>