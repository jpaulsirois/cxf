<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="0d1b4076-9f59-4e76-8488-0a833a632c75" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="Test: Update Attachment with no ownerId" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config"><con:description id="5ca88752-505f-48ba-bf4e-01467226488c">Verify  updateAttachment  reponse :  ensure you get no stack trace and a meaningful error message.
When input : invalid ownerID ( NULL) </con:description><con:settings><con:setting id="0d1b4076-9f59-4e76-8488-0a833a632c75fileName">Test%3A-Update-Attachment-with-no-ownerId</con:setting></con:settings><con:savedRecentRuns>1</con:savedRecentRuns><con:testStep type="groovy" name="ProjectData" id="6fb9d682-19cc-4237-8caa-ce39b9b296ae"><con:settings/><con:config><script>def tSuite = testRunner.getTestCase().getTestSuite()

    tSuite.setPropertyValue("donorDeathTypeId", "1")
    tSuite.setPropertyValue("donorFacility-1-Id", "17")
    tSuite.setPropertyValue("donorFacility-2-Id", "3")
    tSuite.setPropertyValue("donorTypeId", "4")
    tSuite.setPropertyValue("recipientHlaLabId", "93")
    tSuite.setPropertyValue("recipientOdoId", "23")
    tSuite.setPropertyValue("recipientPrefix", "QT-")
    tSuite.setPropertyValue("recipientTxCenterId", "92")
    tSuite.setPropertyValue("recipientProvId", "11")
    tSuite.setPropertyValue("phinProvince", "11")
    tSuite.setPropertyValue("city", "Montreal")
    //tSuite.setPropertyValue("recipientId", null)
    //tSuite.setPropertyValue("donorId", null)
</script></con:config></con:testStep><con:testStep type="groovy" name="TestSuiteData" id="dc750bf3-8bab-433f-be18-939d25c6fb78"><con:settings/><con:config><script>def tSuite = testRunner.getTestCase().getTestSuite()

    tSuite.setPropertyValue("donorDeathTypeId", "1")
    tSuite.setPropertyValue("donorFacility-1-Id", "17")
    tSuite.setPropertyValue("donorFacility-2-Id", "3")
    tSuite.setPropertyValue("donorTypeId", "4")
    tSuite.setPropertyValue("recipientHlaLabId", "93")
    tSuite.setPropertyValue("recipientOdoId", "23")
    tSuite.setPropertyValue("recipientPrefix", "QT-")
    tSuite.setPropertyValue("recipientTxCenterId", "92")
    tSuite.setPropertyValue("recipientProvId", "11")
    tSuite.setPropertyValue("phinProvince", "11")
    tSuite.setPropertyValue("city", "Montreal")
    //tSuite.setPropertyValue("recipientId", null)
    //tSuite.setPropertyValue("donorId", null)
</script></con:config></con:testStep><con:testStep type="groovy" name="Setup recipient fields" id="0675f6b8-f8c9-49b4-a51b-313d6514876e"><con:settings/><con:config><script>import cbs.DateUtils;
import cbs.LookupUtils;
import cbs.CtrUtils;

    def dateUtils = new DateUtils()
    def lookupUtils = new LookupUtils()
    def ctrUtils= new CtrUtils()

    def tCase = testRunner.getTestCase()
    Date dateNow = new Date()

    tCase.setPropertyValue("recRndId", ctrUtils.getRndId().toString())

    Date dateOfBirth = ctrUtils.getRndDOB(20,50)
    tCase.setPropertyValue("dateOfBirth", dateUtils.formatDate( dateOfBirth ))

    //genderId = lookupUtils.getRandomLookupId("LT_GENDER")
    tCase.setPropertyValue("genderId", lookupUtils.getRandomLookupId("LT_GENDER") )

    height = ctrUtils.getRndHeight(dateUtils.formatDate( dateOfBirth ))
    tCase.setPropertyValue("height", height.toString() )

    weight = ctrUtils.getRndWeight(dateUtils.formatDate( dateOfBirth ))
    tCase.setPropertyValue("weight", weight.toString() )

    //bloodGroupId = lookupUtils.getRandomLookupId("LT_ABO")
    tCase.setPropertyValue("bloodGroupId", lookupUtils.getRandomLookupId("LT_ABO") )

    rhId = lookupUtils.getRandomLookupId("LT_RH")
    tCase.setPropertyValue("rhId", rhId )

    Date mostRecentDialysisDate = ctrUtils.getRandomDateFromInterval(dateOfBirth, dateNow);
    tCase.setPropertyValue("mostRecentDialysisDate", dateUtils.formatDate(mostRecentDialysisDate))
    log.info("mostRecentDialysisDate: "+mostRecentDialysisDate)

    Date listDateTime = ctrUtils.getRandomDateFromInterval(mostRecentDialysisDate, dateNow);
    tCase.setPropertyValue("listDateTime", dateUtils.formatDate(listDateTime))
    log.info("listDateTime: "+listDateTime)

    Date medicalStatusChangeDate = ctrUtils.getRandomDateFromInterval(listDateTime, dateNow);
    tCase.setPropertyValue("listDateTime", dateUtils.formatDate(medicalStatusChangeDate))
    log.info("medicalStatusChangeDate: "+medicalStatusChangeDate)

    log.info("The end")
</script></con:config></con:testStep><con:testStep type="request" id="b6629490-296e-4b85-a752-93111a7961f4" name="Recipient-Fields minimal-Ror kidney - heart"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>ExternalCtr3WSPortBinding</con:interface><con:operation>addRecipientByNationalRecipientId</con:operation><con:request name="Recipient-Fields minimal-Ror kidney - heart" id="26b4eb36-2fe6-4d92-998b-66887b7da136"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>https://ctr2test3.transplantregistry.ca:443/otd-ws/ctr3</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ctr="http://ctr3ws.cbs.com/">
   <soapenv:Header>
      <wsse:Security soapenv:mustUnderstand="0" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">
         <wsse:UsernameToken wsu:Id="UsernameToken-3" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">
            <wsse:Username>WS_QC</wsse:Username>
            <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">Anypw123!</wsse:Password>
         </wsse:UsernameToken>
      </wsse:Security>
   </soapenv:Header>
   <soapenv:Body>
      <ctr:addRecipientByNationalRecipientId>
         <arg0>
            <firstName>Fn-${#TestCase#recRndId}</firstName>
            <lastName>Ln-${#TestCase#recRndId}</lastName>
            <city>Montreal</city>
            <province>
               <id>11</id>
               <!--<bizRef>QC</bizRef>-->
            </province>
            <dateOfBirth>${#TestCase#dateOfBirth}</dateOfBirth>
            <gender>
               <id>${#TestCase#genderId}</id>
            </gender>
            <height>${#TestCase#height}</height>
            <weight>${#TestCase#weight}</weight>
            <localRecipientId>localId-${#TestCase#recRndId}</localRecipientId>
            <phin>QT-${#TestCase#recRndId}</phin>
            <transplantType>
               <id>1</id>
            </transplantType>
            <bloodGroup>
               <id>${#TestCase#bloodGroupId}</id>
            </bloodGroup>
            <rh>
               <id>${#TestCase#rhId}</id>
            </rh>
            <organRequests>
               <!--heart-->
               <id>0</id>
               <organMedicalStatus>
                  <id>2</id>
               </organMedicalStatus>
               <organRequired>
                  <id>1</id>
               </organRequired>
               <listDateTime>${#TestCase#listDateTime}</listDateTime>
               <status>
                  <id>2</id>
               </status>
            </organRequests>
            <opo>
               <!--<id>${#Project#recipientOdoId}</id>-->
               <id>23</id>
               <!--<facilityName>Transplant-Qu√©bec</facilityName>-->
            </opo>
            <!--Optional:-->
            <transplantCentre>
               <id>${#TestSuite#recipientTxCenterId}</id>
            </transplantCentre>
            <!--<referralCentres>-->
            <!--<id>?</id>-->
            <!--</referralCentres>-->
            <hlaLab>
               <id>${#TestSuite#recipientHlaLabId}</id>
            </hlaLab>
            <phinProvince>
               <!--<id>${#Project#phinProvince}</id>-->
               <id>11</id>
            </phinProvince>
         </arg0>
      </ctr:addRecipientByNationalRecipientId>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Fault Assertion" id="ddd7baa0-eee3-4552-8c61-5391202d2861" name="Not SOAP Fault"/><con:assertion type="Schema Compliance" id="fa9aef0c-f842-48cf-b0f2-4ac7e15fcff9" name="Schema Compliance"><con:configuration/></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:wsaConfig action="http://ctr3ws.cbs.com/ExternalCtr3WS/addRecipientByNationalRecipientIdRequest" mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/><con:environmentSpec><con:entry environmentId="c94d917d-022b-4762-a9eb-762d7b0415eb"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:request></con:config></con:testStep><con:testStep type="groovy" name="Save recipient" id="eb830f49-329d-41a5-ad41-c28583a9445e"><con:settings/><con:config><script>def tCase = testRunner.getTestCase()

def recipientId = context.expand( '${Recipient-Fields minimal-Ror kidney - heart#Response#declare namespace ns2=\'http://ctr3ws.cbs.com/\'; //ns2:addRecipientByNationalRecipientIdResponse[1]/return[1]/nationalRecipientId[1]}' )
tCase.setPropertyValue("recipientId", recipientId )

def rorIdHeart = context.expand( '${Recipient-Fields minimal-Ror kidney - heart#Response#declare namespace ns2=\'http://ctr3ws.cbs.com/\'; //ns2:addRecipientByNationalRecipientIdResponse[1]/return[1]/organRequests[1]/id[1]}' )
tCase.setPropertyValue("rorIdHeart", rorIdHeart )
</script></con:config></con:testStep><con:testStep type="request" id="ede11a86-412e-4213-87f1-26d15425688b" name="uploadAttachment- ORGAN_REQUESTS"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>ExternalCtr3WSPortBinding</con:interface><con:operation>uploadAttachment</con:operation><con:request name="uploadAttachment- ORGAN_REQUESTS" id="a0d0a6bc-8db1-4acd-b81b-ba63639327f0"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>https://ctr2test3.transplantregistry.ca:443/otd-ws/ctr3</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ctr="http://ctr3ws.cbs.com/">\r
   <soapenv:Header>\r
      <wsse:Security soapenv:mustUnderstand="0" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">\r
         <wsse:UsernameToken wsu:Id="UsernameToken-3" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">\r
            <wsse:Username>WS_QC</wsse:Username>\r
            <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">Anypw123!</wsse:Password>\r
         </wsse:UsernameToken>\r
      </wsse:Security>\r
   </soapenv:Header>\r
   <soapenv:Body>\r
      <ctr:uploadAttachment>\r
         <arg0>\r
            <attachmentID>0</attachmentID>\r
            <nationalID>${#TestCase#recipientId}</nationalID>\r
            <attachmentSection>\r
               <bizRef>ORGAN_REQUESTS</bizRef>\r
            </attachmentSection>\r
            <description>ORGAN_REQUESTS -  attachment  descripition  #1</description>\r
            <sideBysideFlag>true</sideBysideFlag>\r
            <ownerID>${#TestCase#rorIdHeart}</ownerID>\r
         </arg0>\r
         <arg1>\r
            <attachmentData>BaseHealthService</attachmentData>\r
            <filename>${#Project#attachmentsFolder}/all-tests.html</filename>\r
         </arg1>\r
      </ctr:uploadAttachment>\r
   </soapenv:Body>\r
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Fault Assertion" id="09f03bea-f0d6-4e5e-b772-8c3e8f711273" name="Not SOAP Fault"/><con:assertion type="Schema Compliance" id="0eb0dc3e-eee0-4231-ad2b-262061326422" name="Schema Compliance"><con:configuration/></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:wsaConfig action="http://ctr3ws.cbs.com/ExternalCtr3WS/uploadAttachmentRequest" mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/><con:environmentSpec><con:entry environmentId="c94d917d-022b-4762-a9eb-762d7b0415eb"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:request></con:config></con:testStep><con:testStep type="groovy" name="Save attachment info" id="bb179c50-71e4-4832-bf90-e348a00a4fdf"><con:settings/><con:config><script>def tCase = testRunner.getTestCase()

def attachmentId = context.expand( '${uploadAttachment- ORGAN_REQUESTS#Response#declare namespace ns2=\'http://ctr3ws.cbs.com/\'; //ns2:uploadAttachmentResponse[1]/return[1]/attachmentID[1]}' )
tCase.setPropertyValue("attachmentId", attachmentId )


def ownerId = context.expand( '${uploadAttachment- ORGAN_REQUESTS#Response#declare namespace ns2=\'http://ctr3ws.cbs.com/\'; //ns2:uploadAttachmentResponse[1]/return[1]/ownerID[1]}' )
tCase.setPropertyValue("ownerId", ownerId )
</script></con:config></con:testStep><con:testStep type="request" id="70c884ef-eebc-41c3-80b0-2bebcc3b3dde" name="updateAttachment -ORGAN_REQUESTS- ownerId =  NULL"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>ExternalCtr3WSPortBinding</con:interface><con:operation>updateAttachment</con:operation><con:request name="updateAttachment -ORGAN_REQUESTS- ownerId =  NULL" id="273dcfe5-7ca7-4bd4-869d-3fde54936f33"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>https://ctr2test3.transplantregistry.ca:443/otd-ws/ctr3</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ctr="http://ctr3ws.cbs.com/">
   <soapenv:Header>
      <wsse:Security soapenv:mustUnderstand="0" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">
         <wsse:UsernameToken wsu:Id="UsernameToken-3" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">
            <wsse:Username>WS_QC</wsse:Username>
            <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">Anypw123!</wsse:Password>
         </wsse:UsernameToken>
      </wsse:Security>
   </soapenv:Header>
   <soapenv:Body>
      <ctr:updateAttachment>
         <arg0>
            
            <attachmentID>${#TestCase#attachmentId}</attachmentID><nationalID>${#TestCase#recipientId}</nationalID>
            <description>ORGAN_REQUESTS -  attachment  descripition  #1 -  update : 1</description>
            <sideBysideFlag>true</sideBysideFlag>
            
            <attachmentSection>
               <bizRef>ORGAN_REQUESTS</bizRef>
            </attachmentSection>
         </arg0>
      </ctr:updateAttachment>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="Not SOAP Fault Assertion" id="ce925558-f00c-4fd1-87c3-47c138f69bfd" name="SOAP Fault"/><con:assertion type="Schema Compliance" id="08464724-9cc5-4ee4-8d2c-6a9d8089536d" name="Schema Compliance"><con:configuration/></con:assertion><con:assertion type="Simple Contains" id="c18553d5-ac23-4388-8668-2f0c17e3effd" name="Contains: attachment.error.emptyOwnerId"><con:configuration><token>ErrorID: attachment.error.emptyOwnerId;</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:wsaConfig action="http://ctr3ws.cbs.com/ExternalCtr3WS/updateAttachmentRequest" mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/><con:environmentSpec><con:entry environmentId="c94d917d-022b-4762-a9eb-762d7b0415eb"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:request></con:config></con:testStep><con:properties><con:property><con:name>recRndId</con:name><con:value>16940118158</con:value></con:property><con:property><con:name>dateOfBirth</con:name><con:value>1987-08-12</con:value></con:property><con:property><con:name>genderId</con:name><con:value>1</con:value></con:property><con:property><con:name>height</con:name><con:value>200</con:value></con:property><con:property><con:name>weight</con:name><con:value>98</con:value></con:property><con:property><con:name>bloodGroupId</con:name><con:value>2</con:value></con:property><con:property><con:name>rhId</con:name><con:value>1</con:value></con:property><con:property><con:name>mostRecentDialysisDate</con:name><con:value>2022-09-13</con:value></con:property><con:property><con:name>listDateTime</con:name><con:value>2023-08-29</con:value></con:property><con:property><con:name>recipientId</con:name><con:value>CTR051208</con:value></con:property><con:property><con:name>rorIdHeart</con:name><con:value>158980</con:value></con:property><con:property><con:name>attachmentId</con:name><con:value>75370</con:value></con:property><con:property><con:name>ownerId</con:name><con:value>158980</con:value></con:property></con:properties><con:reportParameters/><con:environmentSpec><con:entry environmentId="c94d917d-022b-4762-a9eb-762d7b0415eb"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:testCase>