<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="115053ea-d2b7-414b-aa98-a19585bf8729" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="findAttachments" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config"><con:description id="03b9fd73-e42a-44b5-bae0-f8e63808d32e">Verify that an OFFER_XM attachment is listed in the  WS findAttachments() method response .</con:description><con:settings><con:setting id="115053ea-d2b7-414b-aa98-a19585bf8729fileName">findAttachments</con:setting></con:settings><con:savedRecentRuns>1</con:savedRecentRuns><con:testStep type="groovy" name="ProjectData" id="a4f9a597-68b3-44b1-a01a-3f8605eff951"><con:settings/><con:config><script>def tSuite = testRunner.getTestCase().getTestSuite()

    tSuite.setPropertyValue("donorDeathTypeId", "1")
    tSuite.setPropertyValue("donorFacility-1-Id", "17")
    tSuite.setPropertyValue("donorFacility-2-Id", "3")
    tSuite.setPropertyValue("donorTypeId", "4")
    tSuite.setPropertyValue("recipientHlaLabId", "93")
    tSuite.setPropertyValue("recipientOdoId", "23")
    tSuite.setPropertyValue("recipientPrefix", "QT-")
    tSuite.setPropertyValue("recipientTxCenterId", "92")
    tSuite.setPropertyValue("recipientProvId", "11")
    tSuite.setPropertyValue("phinProvince", "11")
    tSuite.setPropertyValue("city", "Montreal")
    //tSuite.setPropertyValue("recipientId", null)
    //tSuite.setPropertyValue("donorId", null)
</script></con:config></con:testStep><con:testStep type="groovy" name="get  shared recipient Id" id="a1c5b26c-6263-40ee-a866-64140b0ad68d"><con:settings/><con:config><script>def tSuite = testRunner.getTestCase().getTestSuite()
def tCase = testRunner.getTestCase()

def donorId = context.expand( '${#TestSuite#donorId}' )
tCase.setPropertyValue("donorId", donorId )

def recipientId = context.expand( '${#TestCase#recipientId}' )
tCase.setPropertyValue("recipientId", context.expand( '${#TestSuite#recipientId}' ))</script></con:config></con:testStep><con:testStep type="request" id="1ba67251-4b4b-473f-b9cc-c917f8973a99" name="findAttachments-donor-OFFERS_XM"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>ExternalCtr3WSPortBinding</con:interface><con:operation>findAttachments</con:operation><con:request name="findAttachments-donor-OFFERS_XM" id="91c04e7e-f1fa-4e8f-ae93-7f98497cb153"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>https://ctr2test3.transplantregistry.ca:443/otd-ws/ctr3</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ctr="http://ctr3ws.cbs.com/">
   <soapenv:Header>
      <wsse:Security soapenv:mustUnderstand="0" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">
         <wsse:UsernameToken wsu:Id="UsernameToken-3" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">
            <wsse:Username>WS_BC</wsse:Username>
            <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">Anypw123!</wsse:Password>
         </wsse:UsernameToken>
      </wsse:Security>
   </soapenv:Header>
   <soapenv:Body>
      <ctr:findAttachments>
         <arg0>${#TestCase#donorId}</arg0>
         <arg1>
            <bizRef>OFFERS_XM</bizRef>
         </arg1>
      </ctr:findAttachments>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Fault Assertion" id="f75103c6-95fc-4e89-8bcd-bfdaff813343" name="Not SOAP Fault"/><con:assertion type="Schema Compliance" id="b43fa073-f681-491d-a8b4-8ab1d91ea794" name="Schema Compliance"><con:configuration/></con:assertion><con:assertion type="Simple Contains" id="d33d32d8-9826-4320-9ff7-c640f7dbb8db" name="Contains: &lt;bizRef>ORGAN_REQUESTS&lt;/bizRef> " disabled="true"><con:configuration><token>&lt;bizRef>ORGAN_REQUESTS&lt;/bizRef></token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:wsaConfig action="http://ctr3ws.cbs.com/ExternalCtr3WS/findAttachmentsRequest" mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/><con:environmentSpec><con:entry environmentId="c94d917d-022b-4762-a9eb-762d7b0415eb"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:request></con:config></con:testStep><con:testStep type="groovy" name="Setup recipient fields" id="66379bc7-b122-4b6b-863b-20f9e1870e81"><con:settings/><con:config><script>import cbs.DateUtils;
import cbs.LookupUtils;
import cbs.CtrUtils;

    def dateUtils = new DateUtils()
    def lookupUtils = new LookupUtils()
    def ctrUtils= new CtrUtils()

    def tCase = testRunner.getTestCase()
    Date dateNow = new Date()

    tCase.setPropertyValue("recRndId", ctrUtils.getRndId().toString())

    Date dateOfBirth = ctrUtils.getRndDOB(20,50)
    tCase.setPropertyValue("dateOfBirth", dateUtils.formatDate( dateOfBirth ))

    //genderId = lookupUtils.getRandomLookupId("LT_GENDER")
    tCase.setPropertyValue("genderId", lookupUtils.getRandomLookupId("LT_GENDER") )

    height = ctrUtils.getRndHeight(dateUtils.formatDate( dateOfBirth ))
    tCase.setPropertyValue("height", height.toString() )

    weight = ctrUtils.getRndWeight(dateUtils.formatDate( dateOfBirth ))
    tCase.setPropertyValue("weight", weight.toString() )

    //bloodGroupId = lookupUtils.getRandomLookupId("LT_ABO")
    tCase.setPropertyValue("bloodGroupId", lookupUtils.getRandomLookupId("LT_ABO") )

    rhId = lookupUtils.getRandomLookupId("LT_RH")
    tCase.setPropertyValue("rhId", rhId )

    Date mostRecentDialysisDate = ctrUtils.getRandomDateFromInterval(dateOfBirth, dateNow);
    tCase.setPropertyValue("mostRecentDialysisDate", dateUtils.formatDate(mostRecentDialysisDate))
    log.info("mostRecentDialysisDate: "+mostRecentDialysisDate)

    Date listDateTime = ctrUtils.getRandomDateFromInterval(mostRecentDialysisDate, dateNow);
    tCase.setPropertyValue("listDateTime", dateUtils.formatDate(listDateTime))
    log.info("listDateTime: "+listDateTime)

    Date medicalStatusChangeDate = ctrUtils.getRandomDateFromInterval(listDateTime, dateNow);
    tCase.setPropertyValue("listDateTime", dateUtils.formatDate(medicalStatusChangeDate))
    log.info("medicalStatusChangeDate: "+medicalStatusChangeDate)

    log.info("The end")
</script></con:config></con:testStep><con:testStep type="request" id="e6a14cb6-6bdb-4d6b-b511-62343dcc5166" name="Recipient-Fields minimal-Ror kidney - heart"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>ExternalCtr3WSPortBinding</con:interface><con:operation>addRecipientByNationalRecipientId</con:operation><con:request name="Recipient-Fields minimal-Ror kidney - heart" id="26b4eb36-2fe6-4d92-998b-66887b7da136"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>https://ctr2test3.transplantregistry.ca:443/otd-ws/ctr3</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ctr="http://ctr3ws.cbs.com/">
   <soapenv:Header>
      <wsse:Security soapenv:mustUnderstand="0" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">
         <wsse:UsernameToken wsu:Id="UsernameToken-3" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">
            <wsse:Username>WS_QC</wsse:Username>
            <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">Anypw123!</wsse:Password>
         </wsse:UsernameToken>
      </wsse:Security>
   </soapenv:Header>
   <soapenv:Body>
      <ctr:addRecipientByNationalRecipientId>
         <arg0>
            <firstName>Fn-${#TestCase#recRndId}</firstName>
            <lastName>Ln-${#TestCase#recRndId}</lastName>
            <city>Montreal</city>
            <province>
               <id>11</id>
               <!--<bizRef>QC</bizRef>-->
            </province>
            <dateOfBirth>${#TestCase#dateOfBirth}</dateOfBirth>
            <gender>
               <id>${#TestCase#genderId}</id>
            </gender>
            <height>${#TestCase#height}</height>
            <weight>${#TestCase#weight}</weight>
            <localRecipientId>localId-${#TestCase#recRndId}</localRecipientId>
            <phin>QT-${#TestCase#recRndId}</phin>
            <transplantType>
               <id>2</id>
            </transplantType>
            <bloodGroup>
               <id>${#TestCase#bloodGroupId}</id>
            </bloodGroup>
            <rh>
               <id>${#TestCase#rhId}</id>
            </rh>
            <organRequests>
               <id>0</id>
               <organMedicalStatus>
                  <id>27</id>
               </organMedicalStatus>
               <!--kidney-->
               <organRequired>
                  <id>5</id>
               </organRequired>
               <listDateTime>${#TestCase#listDateTime}</listDateTime>
               <status>
                  <id>2</id>
               </status>
            </organRequests>
            <organRequests>
               <!--heart-->
               <id>0</id>
               <organMedicalStatus>
                  <id>2</id>
               </organMedicalStatus>
               <organRequired>
                  <id>1</id>
               </organRequired>
               <listDateTime>${#TestCase#listDateTime}</listDateTime>
               <status>
                  <id>2</id>
               </status>
            </organRequests>
            <opo>
               <!--<id>${#Project#recipientOdoId}</id>-->
               <id>23</id>
               <!--<facilityName>Transplant-Québec</facilityName>-->
            </opo>
            <!--Optional:-->
            <transplantCentre>
               <id>${#TestSuite#recipientTxCenterId}</id>
            </transplantCentre>
            <!--<referralCentres>-->
            <!--<id>?</id>-->
            <!--</referralCentres>-->
            <hlaLab>
               <id>${#TestSuite#recipientHlaLabId}</id>
            </hlaLab>
            <phinProvince>
               <!--<id>${#Project#phinProvince}</id>-->
               <id>11</id>
            </phinProvince>
         </arg0>
      </ctr:addRecipientByNationalRecipientId>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Fault Assertion" id="ddd7baa0-eee3-4552-8c61-5391202d2861" name="Not SOAP Fault"/><con:assertion type="Schema Compliance" id="fa9aef0c-f842-48cf-b0f2-4ac7e15fcff9" name="Schema Compliance"><con:configuration/></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:wsaConfig action="http://ctr3ws.cbs.com/ExternalCtr3WS/addRecipientByNationalRecipientIdRequest" mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/><con:environmentSpec><con:entry environmentId="c94d917d-022b-4762-a9eb-762d7b0415eb"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:request></con:config></con:testStep><con:testStep type="groovy" name="Save recipient" id="273e0d40-9e3e-4961-9002-c24ac4d6ad25"><con:settings/><con:config><script>def tSuite = testRunner.getTestCase().getTestSuite()
def tCase = testRunner.getTestCase()

def recipientId = context.expand( '${Recipient-Fields minimal-Ror kidney - heart#Response#declare namespace ns2=\'http://ctr3ws.cbs.com/\'; //ns2:addRecipientByNationalRecipientIdResponse[1]/return[1]/nationalRecipientId[1]}' )
tSuite.setPropertyValue("recipientId", recipientId )

def rorIdKidney = context.expand( '${Recipient-Fields minimal-Ror kidney - heart#Response#declare namespace ns2=\'http://ctr3ws.cbs.com/\'; //ns2:addRecipientByNationalRecipientIdResponse[1]/return[1]/organRequests[1]/id[1]}' )
tSuite.setPropertyValue("rorIdKidney", rorIdKidney )

def rorIdHeart = context.expand( '${Recipient-Fields minimal-Ror kidney - heart#Response#declare namespace ns2=\'http://ctr3ws.cbs.com/\'; //ns2:addRecipientByNationalRecipientIdResponse[1]/return[1]/organRequests[2]/id[1]}' )
tSuite.setPropertyValue("rorIdHeart", rorIdHeart )
</script></con:config></con:testStep><con:testStep type="request" id="e98e46e5-7818-41d3-bc1b-5b8efe67e09e" name="findAttachments-recipient-OFFERS_XM"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>ExternalCtr3WSPortBinding</con:interface><con:operation>findAttachments</con:operation><con:request name="findAttachments-recipient-OFFERS_XM" id="91c04e7e-f1fa-4e8f-ae93-7f98497cb153"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>https://ctr2test3.transplantregistry.ca:443/otd-ws/ctr3</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ctr="http://ctr3ws.cbs.com/">
   <soapenv:Header>
      <wsse:Security soapenv:mustUnderstand="0" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">
         <wsse:UsernameToken wsu:Id="UsernameToken-3" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">
            <wsse:Username>WS_QC</wsse:Username>
            <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">Anypw123!</wsse:Password>
         </wsse:UsernameToken>
      </wsse:Security>
   </soapenv:Header>
   <soapenv:Body>
      <ctr:findAttachments>
         <arg0>${#TestCase#recipientId}</arg0>
         <arg1>
            <bizRef>OFFERS_XM</bizRef>
         </arg1>
      </ctr:findAttachments>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="Not SOAP Fault Assertion" id="c5eddfc9-98e7-4065-9aa2-4f51c40d7738" name="SOAP Fault"/><con:assertion type="Schema Compliance" id="b43fa073-f681-491d-a8b4-8ab1d91ea794" name="Schema Compliance"><con:configuration/></con:assertion><con:assertion type="Simple Contains" id="6199c3a3-3147-4759-b232-b44f49809143" name="Contains:  ErrorID: attachment.error.invalidSection"><con:configuration><token>ErrorID: attachment.error.invalidSection;</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:wsaConfig action="http://ctr3ws.cbs.com/ExternalCtr3WS/findAttachmentsRequest" mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/><con:environmentSpec><con:entry environmentId="c94d917d-022b-4762-a9eb-762d7b0415eb"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:request></con:config></con:testStep><con:properties><con:property><con:name>donorId</con:name><con:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">CTD045222</con:value></con:property><con:property><con:name>recipientId</con:name><con:value>CTR044396</con:value></con:property><con:property><con:name>recRndId</con:name><con:value>16790541199</con:value></con:property><con:property><con:name>dateOfBirth</con:name><con:value>1975-03-02</con:value></con:property><con:property><con:name>genderId</con:name><con:value>3</con:value></con:property><con:property><con:name>height</con:name><con:value>100</con:value></con:property><con:property><con:name>weight</con:name><con:value>48</con:value></con:property><con:property><con:name>bloodGroupId</con:name><con:value>3</con:value></con:property><con:property><con:name>rhId</con:name><con:value>1</con:value></con:property><con:property><con:name>mostRecentDialysisDate</con:name><con:value>2007-03-01</con:value></con:property><con:property><con:name>listDateTime</con:name><con:value>2014-11-15</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8e9fd01d-e392-4f9e-9c5a-1c13642bdef8</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>268173fd-efb0-4501-8d38-c91bcb41d962</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>7b538b26-267a-45b0-a750-d2fd034444de</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>82ee2171-a402-4d96-ab84-75e145adac29</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>e70938a0-77b2-47bf-9a64-f6913a303455</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>23e7357e-ca10-4bef-a989-136c698b0946</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>b12f3b5a-c0f4-4035-b2e4-aa646b6164c5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>6f14e5bf-5bd9-4684-9df3-66b15a0c8c0b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:environmentSpec><con:entry environmentId="c94d917d-022b-4762-a9eb-762d7b0415eb"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:testCase>